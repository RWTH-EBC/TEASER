

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Example 11: Export Modelica models for BESMod library using TEASER API &mdash; TEASER 1.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=db26dd79" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=fc837d61"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            TEASER
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../install_teaser.html">Install TEASER</a></li>
<li class="toctree-l1"><a class="reference internal" href="../archetypes.html">Archetype Buildings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../teaser.Examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code/modules.html">teaser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgments.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Issues solved in development</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">TEASER</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Example 11: Export Modelica models for BESMod library using TEASER API</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/e11_export_besmod_models.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="example-11-export-modelica-models-for-besmod-library-using-teaser-api">
<h1>Example 11: Export Modelica models for BESMod library using TEASER API<a class="headerlink" href="#example-11-export-modelica-models-for-besmod-library-using-teaser-api" title="Link to this heading"></a></h1>
<p>This module demonstrates how to export building models from a TEASER project
to ready-to-run simulation models for the Modelica BESMod library.
BESMod enables seamless integration with state-of-the-art energy systems,
such as heat pumps and photovoltaic systems. These systems can be utilized
to generate primary energy demand curves (e.g., for electricity or gas) or
to conduct in-depth analyses of building energy systems. In contrast,
AixLib focuses on ideal heat demand calculation, and IBPSA on
free floating temperature without an ideal heater.
You can execute this example using
<a class="reference external" href="https://mybinder.org/v2/gh/RWTH-EBC/TEASER/main?labpath=docs%2Fjupyter_notebooks">jupyter-notebook</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">teaser.examples.e1_generate_archetype</span> <span class="k">as</span> <span class="nn">e1</span>
<span class="kn">import</span> <span class="nn">teaser.logic.utilities</span> <span class="k">as</span> <span class="nn">utilities</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
<section id="standard-export">
<h2>Standard export<a class="headerlink" href="#standard-export" title="Link to this heading"></a></h2>
<p>In e1_generate_archetype we created a Project with three archetype
buildings to get this Project we rerun this example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prj</span> <span class="o">=</span> <span class="n">e1</span><span class="o">.</span><span class="n">example_generate_archetype</span><span class="p">()</span>
</pre></div>
</div>
<p>Configure project settings to ensure compatibility with BESMod. The BESMod
library uses the AixLib.ThermalZones.ReducedOrder.ThermalZone.ThermalZone model
with 4 elements for the demand building model. Other numbers of elements are possible,
but compatability with ARoof for PV and AFloor for UFH systems must be checked first.
Set these parameters in the project:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prj</span><span class="o">.</span><span class="n">used_library_calc</span> <span class="o">=</span> <span class="s1">&#39;AixLib&#39;</span>
<span class="n">prj</span><span class="o">.</span><span class="n">number_of_elements_calc</span> <span class="o">=</span> <span class="mi">4</span>
</pre></div>
</div>
<p>BESMod allows building models to be included in predefined example energy systems:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">examples</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;TEASERHeatLoadCalculation&quot;</span><span class="p">,</span>  <span class="c1"># Ideal electric heater for heat load calculations</span>
    <span class="s2">&quot;HeatPumpMonoenergetic&quot;</span><span class="p">,</span>  <span class="c1"># Heat pump with radiators, buffer and DHW storage, and PV</span>
    <span class="s2">&quot;GasBoilerBuildingOnly&quot;</span>  <span class="c1"># Gas boiler with radiators</span>
<span class="p">]</span>
</pre></div>
</div>
<p>For the hydraulic systems, you have to specify a nominal supply temperature
for heat transfer, e.g. in radiators.
Multiple options are available:</p>
<p>Option 1: Set a single value for all buildings and zones.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">THydSup_nominal</span> <span class="o">=</span> <span class="mi">55</span> <span class="o">+</span> <span class="mf">273.15</span>
</pre></div>
</div>
<p>Option 2: Set values for each building or thermal zone.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">THydSup_nominal</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ResidentialBuilding&quot;</span><span class="p">:</span> <span class="mf">328.15</span><span class="p">,</span>
                   <span class="s2">&quot;OfficeBuilding&quot;</span><span class="p">:</span> <span class="mf">328.15</span><span class="p">,</span>
                   <span class="s2">&quot;InstituteBuilding&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Office&quot;</span><span class="p">:</span> <span class="mf">343.15</span><span class="p">,</span>
                                         <span class="s2">&quot;Floor&quot;</span><span class="p">:</span> <span class="mf">343.15</span><span class="p">,</span>
                                         <span class="s2">&quot;Storage&quot;</span><span class="p">:</span> <span class="mf">343.15</span><span class="p">,</span>
                                         <span class="s2">&quot;Meeting&quot;</span><span class="p">:</span> <span class="mf">343.15</span><span class="p">,</span>
                                         <span class="s2">&quot;Restroom&quot;</span><span class="p">:</span> <span class="mf">343.15</span><span class="p">,</span>
                                         <span class="s2">&quot;ICT&quot;</span><span class="p">:</span> <span class="mf">343.15</span><span class="p">,</span>
                                         <span class="s2">&quot;Laboratory&quot;</span><span class="p">:</span> <span class="mf">328.15</span><span class="p">},</span>
                   <span class="s2">&quot;InstituteBuildingMoisture&quot;</span><span class="p">:</span> <span class="mf">343.15</span><span class="p">,</span>
                   <span class="s2">&quot;ResidentialBuildingTabula&quot;</span><span class="p">:</span> <span class="mf">328.15</span><span class="p">,</span>
                   <span class="s2">&quot;ResidentialBuildingTabulaMulti&quot;</span><span class="p">:</span> <span class="mf">328.15</span><span class="p">}</span>
</pre></div>
</div>
<p>Option 3: Specify values based on construction year.
Here, the value of the next higher specified year is set to the building.
The classification here is taken from:
<a class="reference external" href="https://www.ffe.de/projekte/waermepumpen-fahrplan-finanzielle-kipppunkte-zur-modernisierung-mit-waermepumpen-im-wohngebaeudebestand/">https://www.ffe.de/projekte/waermepumpen-fahrplan-finanzielle-kipppunkte-zur-modernisierung-mit-waermepumpen-im-wohngebaeudebestand/</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">THydSup_nominal</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1950</span><span class="p">:</span> <span class="mi">90</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">,</span>
    <span class="mi">1980</span><span class="p">:</span> <span class="mi">70</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">,</span>
    <span class="mi">2010</span><span class="p">:</span> <span class="mi">55</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">,</span>
    <span class="mi">2024</span><span class="p">:</span> <span class="mi">35</span> <span class="o">+</span> <span class="mf">273.15</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the examples, the parameters for BESMod.Systems.UserProfiles.TEASERProfiles are configured,
including internal gains and heating profiles for each zone.
BESMod requires 24-hour heating profiles, which are used
to define the parameters of the <code class="docutils literal notranslate"><span class="pre">setBakTSetZone</span></code> Pulse block.
By default, the TEASER profiles are applied, but these can be customized if needed.</p>
<p>Additionally, location-specific parameters must be set, which can be achieved using the following function.
The default values provided here correspond to Mannheim.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">weather_file_path</span> <span class="o">=</span> <span class="n">utilities</span><span class="o">.</span><span class="n">get_full_path</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="s2">&quot;data&quot;</span><span class="p">,</span>
        <span class="s2">&quot;input&quot;</span><span class="p">,</span>
        <span class="s2">&quot;inputdata&quot;</span><span class="p">,</span>
        <span class="s2">&quot;weatherdata&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DEU_BW_Mannheim_107290_TRY2010_12_Jahr_BBSR.mos&quot;</span><span class="p">))</span>

<span class="n">prj</span><span class="o">.</span><span class="n">set_location_parameters</span><span class="p">(</span><span class="n">t_outside</span><span class="o">=</span><span class="mf">262.65</span><span class="p">,</span>
                            <span class="n">t_ground</span><span class="o">=</span><span class="mf">286.15</span><span class="p">,</span>
                            <span class="n">weather_file_path</span><span class="o">=</span><span class="n">weather_file_path</span><span class="p">,</span>
                            <span class="n">calc_all_buildings</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>To make sure the parameters are calculated correctly we recommend to
run prj.calc_all_buildings() function which is here already done in the set_location_parameters function.</p>
<p>Export all buildings to BESMod and include them in predefined example systems.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">prj</span><span class="o">.</span><span class="n">export_besmod</span><span class="p">(</span>
    <span class="n">THydSup_nominal</span><span class="o">=</span><span class="n">THydSup_nominal</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="n">save_dir_path</span><span class="p">,</span>
    <span class="n">examples</span><span class="o">=</span><span class="n">examples</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="partial-retrofit-export">
<h2>Partial retrofit export<a class="headerlink" href="#partial-retrofit-export" title="Link to this heading"></a></h2>
<p>The partial retrofit option of the energy system in BESMod can also be utilized.
For more information on this see BESMod.UsersGuide.GettingStarted.Parameterization.
To enable this here, the nominal heat flow of each zone in the building must be extracted prior to the retrofit.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">QBuiOld_flow_design</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">bldg</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">tz</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">tz</span><span class="o">.</span><span class="n">model_attr</span><span class="o">.</span><span class="n">heat_load</span> <span class="k">for</span> <span class="n">tz</span> <span class="ow">in</span> <span class="n">bldg</span><span class="o">.</span><span class="n">thermal_zones</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">bldg</span> <span class="ow">in</span> <span class="n">prj</span><span class="o">.</span><span class="n">buildings</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Retrofit project buildings and recalculate parameters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ArchetypeExample_partial_retrofit&quot;</span>
<span class="n">prj</span><span class="o">.</span><span class="n">retrofit_all_buildings</span><span class="p">(</span>
    <span class="n">year_of_retrofit</span><span class="o">=</span><span class="mi">2015</span><span class="p">,</span>
    <span class="n">type_of_retrofit</span><span class="o">=</span><span class="s2">&quot;adv_retrofit&quot;</span><span class="p">,</span>
    <span class="n">window_type</span><span class="o">=</span><span class="s1">&#39;Alu- oder Stahlfenster, Isolierverglasung&#39;</span><span class="p">,</span>
    <span class="n">material</span><span class="o">=</span><span class="s1">&#39;EPS_perimeter_insulation_top_layer&#39;</span>
<span class="p">)</span>
<span class="n">prj</span><span class="o">.</span><span class="n">calc_all_buildings</span><span class="p">()</span>
</pre></div>
</div>
<p>By default, radiator transfer systems are not retrofitted when the
QBuiOld_flow_design parameter is provided and differs from the new nominal heat flow.
Additionally, new THydSup_nominal temperatures can be specified alongside
THydSupOld_design values, which are used for radiator sizing but not for control settings.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">prj</span><span class="o">.</span><span class="n">export_besmod</span><span class="p">(</span>
    <span class="n">THydSup_nominal</span><span class="o">=</span><span class="n">THydSup_nominal</span><span class="p">,</span>
    <span class="n">QBuiOld_flow_design</span><span class="o">=</span><span class="n">QBuiOld_flow_design</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="n">save_dir_path</span><span class="p">,</span>
    <span class="n">examples</span><span class="o">=</span><span class="n">examples</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="custom-export">
<h2>Custom export<a class="headerlink" href="#custom-export" title="Link to this heading"></a></h2>
<p>Additionally, we have the flexibility to define custom templates for including buildings in specific setups.
For instance, a custom template is defined here to include the building in the
ModelicaConferencePaper example from BESMod, which features an integrated battery system.</p>
<p>Custom template
&lt; %namespace file = “/modelica_language/” import=”get<a href="#id1"><span class="problematic" id="id2">*</span></a>list” / &gt;
within ${bldg.parent.name}.${bldg.name};
model ModelicaConferencePaper${bldg.name}</p>
<blockquote>
<div><blockquote>
<div><dl>
<dt>extends BESMod.Examples.ModelicaConferencePaper.PartialModelicaConferenceUseCase(</dt><dd><p>redeclare ${bldg.name} building,
redeclare BESMod.Systems.UserProfiles.TEASERProfiles
userProfiles(fileNameIntGains=Modelica.Utilities.Files.loadResource(</p>
<blockquote>
<div><dl class="simple">
<dt>“modelica://${bldg.parent.name}/${bldg.name}/InternalGains*${bldg.name}.txt”),</dt><dd><dl class="simple">
<dt>setBakTSetZone(amplitude=${get_list(setBakTSetZone_amplitude)},</dt><dd><p>width =${get_list(setBakTSetZone_width)},
startTime =${get_list(setBakTSetZone_startTime)})),</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</dd>
<dt>systemParameters(nZones=${len(bldg.thermal_zones)},</dt><dd><p>QBui_flow_nominal = building.QRec_flow_nominal,
TOda_nominal =${TOda_nominal},
TSetZone_nominal =${get_list(TSetZone_nominal)},
THydSup_nominal =${THydSup_nominal},
QBuiOld_flow_design =${QBuiOld_flow_design},
THydSupOld_design =${THydSupOld_design},
filNamWea = Modelica.Utilities.Files.loadResource(</p>
<blockquote>
<div><p>“modelica://${bldg.parent.name}/Resources/${bldg.parent.weather_file_name}”)));</p>
</div></blockquote>
</dd>
</dl>
</div></blockquote>
<p>extends Modelica.Icons.Example;</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">annotation</span><span class="p">(</span><span class="n">experiment</span><span class="p">(</span><span class="n">StopTime</span><span class="o">=</span><span class="mi">172800</span><span class="p">,</span>
                      <span class="n">Interval</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
                      <span class="n">Tolerance</span><span class="o">=</span><span class="mf">1e-06</span><span class="p">),</span>
           <span class="n">__Dymola_Commands</span><span class="p">(</span><span class="n">file</span><span class="o">=</span>
                             <span class="s2">&quot;Resources/Scripts/Dymola/$</span><span class="si">{bldg.name}</span><span class="s2">/ModelicaConferencePaper$</span><span class="si">{bldg.name}</span><span class="s2">.mos&quot;</span>
                             <span class="s2">&quot;Simulate and plot&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p>end
ModelicaConferencePaper${bldg.name};</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ArchetypeExample_custom&quot;</span>

<span class="n">custom_template_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;examplefiles&quot;</span><span class="p">,</span> <span class="s2">&quot;custom_besmod_templates&quot;</span>
<span class="p">)</span>
<span class="n">custom_example_template</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ModelicaConferencePaper&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">custom_template_path</span><span class="p">,</span> <span class="s2">&quot;custom_template.txt&quot;</span><span class="p">)}</span>
</pre></div>
</div>
<p>The template also includes a .mos script as part of its annotation.
By default, the provided examples export a basic “simulate and plot” script,
which is incorporated into their annotation, as shown in the custom example.
Additionally, you have the flexibility to modify the template for existing examples
and define custom scripts for your tailored examples.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">custom_script</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;HeatPumpMonoenergetic&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">custom_template_path</span><span class="p">,</span> <span class="s2">&quot;custom_script_hp_mono.txt&quot;</span><span class="p">),</span>
                 <span class="s2">&quot;ModelicaConferencePaper&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">custom_template_path</span><span class="p">,</span> <span class="s2">&quot;custom_script.txt&quot;</span><span class="p">)}</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">prj</span><span class="o">.</span><span class="n">export_besmod</span><span class="p">(</span>
    <span class="n">THydSup_nominal</span><span class="o">=</span><span class="n">THydSup_nominal</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="n">save_dir_path</span><span class="p">,</span>
    <span class="n">examples</span><span class="o">=</span><span class="n">examples</span><span class="p">,</span>
    <span class="n">custom_examples</span><span class="o">=</span><span class="n">custom_example_template</span><span class="p">,</span>
    <span class="n">custom_script</span><span class="o">=</span><span class="n">custom_script</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2017, RWTH Aachen University, E.ON Energy Research Center, Institute for Energy Efficienct Buildings and Indoor Climate.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>